<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Museum Cloud Naufal ‚ú®</title>
    <style>
        :root { --primary: #6d5d6e; --bg: #fdfaf6; --accent: #4a3f4b; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Segoe UI', sans-serif; background-color: var(--bg); overflow-x: hidden; }

        #digital-clock {
            position: fixed; top: 15px; right: 15px;
            background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px);
            padding: 8px 15px; border-radius: 20px; font-weight: bold;
            font-size: 0.9rem; color: var(--primary); z-index: 5000; border: 1px solid rgba(109, 93, 110, 0.2);
        }

        #landing {
            position: fixed; inset: 0; 
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=80&w=1200&auto=format&fit=crop');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 3000; color: white; text-align: center; transition: 0.8s;
        }

        .btn-enter { padding: 15px 45px; border-radius: 30px; border: none; cursor: pointer; font-weight: bold; background: white; color: #333; margin-top: 20px; }

        #app { display: none; padding-top: 60px; padding-bottom: 100px; min-height: 100vh; }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 25px; }
        
        input, textarea, select { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #eee; border-radius: 15px; box-sizing: border-box; font-family: inherit; }
        .btn-action { background: var(--primary); color: white; border: none; width: 100%; padding: 16px; border-radius: 18px; font-weight: bold; cursor: pointer; }

        /* Progress Bar */
        #upload-container { display: none; margin-top: 20px; text-align: center; }
        .progress-wrapper { width: 100%; background: #eee; height: 12px; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        #progress-fill { width: 0%; height: 100%; background: var(--primary); transition: width 0.2s; }

        /* Gallery */
        .music-box { background: #fff; padding: 15px; border-radius: 20px; margin-bottom: 25px; border: 1px dashed var(--primary); text-align: center; }
        .moment-card { background: white; border-radius: 20px; overflow: hidden; margin-bottom: 25px; box-shadow: 0 12px 25px rgba(0,0,0,0.06); }
        .moment-card img, .moment-card video { width: 100%; display: block; }
        .moment-body { padding: 20px; }
        
        .copyright { text-align: center; color: #aaa; font-size: 0.75rem; margin-top: 30px; }
        nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; padding: 15px 0; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; color: #bbb; cursor: pointer; font-size: 0.8rem; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="digital-clock">00:00:00</div>

    <div id="landing">
        <h1>Cloud Museum Naufal ‚ú®</h1>
        <button class="btn-enter" onclick="startApp()">Masuk Galeri</button>
    </div>

    <div id="app">
        <div class="container">
            <div id="view-add">
                <h2 style="text-align: center;">Tambah Kenangan</h2>
                <div class="card">
                    <label style="font-size: 0.8rem; font-weight: bold;">Pilih Metode:</label>
                    <select id="upload-method" onchange="toggleUploadMethod()">
                        <option value="file">Upload File (Max 100MB)</option>
                        <option value="link">Tempel Link (Untuk Video 1GB+)</option>
                    </select>

                    <div id="method-file">
                        <input type="file" id="inp-file" accept="image/*,video/*">
                    </div>

                    <div id="method-link" class="hidden">
                        <input type="text" id="inp-link" placeholder="Tempel link video (Catbox/GDrive/dll)">
                    </div>

                    <input type="text" id="inp-title" placeholder="Judul kenangan...">
                    <textarea id="inp-desc" rows="3" placeholder="Cerita momen ini..."></textarea>
                    
                    <button id="btn-save" class="btn-action" onclick="handleProcess()">Simpan Kenangan</button>
                    
                    <div id="upload-container">
                        <div id="status-text">Mengirim...</div>
                        <div class="progress-wrapper"><div id="progress-fill"></div></div>
                    </div>
                </div>
            </div>

            <div id="view-gallery" class="hidden">
                <h2 style="text-align: center;">Galeri</h2>
                <div class="music-box">
                    <p>üéµ Putar Musik</p>
                    <audio id="bg-music" controls loop src="https://files.catbox.moe/tcsdus.mp3"></audio>
                </div>
                <div id="gallery-list"></div>
                <div class="copyright">Copyright ¬© Naufal</div>
            </div>
        </div>

        <nav>
            <div class="nav-item active" id="nav-add" onclick="pindahTab('add')">‚ûï TAMBAH</div>
            <div class="nav-item" id="nav-gallery" onclick="pindahTab('gallery')">üñºÔ∏è GALERI</div>
        </nav>
    </div>

    <script>
        const CLOUDINARY_CONFIG = { cloudName: "dtpugpvm1", uploadPreset: "momen_naufal" };

        function updateClock() {
            const now = new Date();
            document.getElementById('digital-clock').innerText = now.toLocaleTimeString('id-ID');
        }
        setInterval(updateClock, 1000);

        function startApp() {
            document.getElementById('landing').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            render();
        }

        function toggleUploadMethod() {
            const method = document.getElementById('upload-method').value;
            document.getElementById('method-file').classList.toggle('hidden', method !== 'file');
            document.getElementById('method-link').classList.toggle('hidden', method !== 'link');
        }

        function handleProcess() {
            const method = document.getElementById('upload-method').value;
            if (method === 'file') {
                uploadToCloudinary();
            } else {
                saveByLink();
            }
        }

        function uploadToCloudinary() {
            const fileInput = document.getElementById('inp-file');
            const title = document.getElementById('inp-title').value;
            if (!fileInput.files[0] || !title) return alert("Isi data!");

            const file = fileInput.files[0];
            const btn = document.getElementById('btn-save');
            const container = document.getElementById('upload-container');
            const bar = document.getElementById('progress-fill');
            const statusText = document.getElementById('status-text');

            btn.disabled = true;
            container.style.display = 'block';

            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", CLOUDINARY_CONFIG.uploadPreset);

            const xhr = new XMLHttpRequest();
            xhr.open("POST", `https://api.cloudinary.com/v1_1/${CLOUDINARY_CONFIG.cloudName}/auto/upload`);

            xhr.upload.onprogress = (e) => {
                const percent = Math.round((e.loaded / e.total) * 100);
                bar.style.width = percent + '%';
                statusText.innerText = `Mengirim: ${percent}%`;
            };

            xhr.onload = () => {
                const data = JSON.parse(xhr.responseText);
                if (xhr.status === 200) {
                    simpanLocal(data.secure_url, data.resource_type);
                } else {
                    alert("Error: " + data.error.message);
                    btn.disabled = false;
                }
            };
            xhr.send(formData);
        }

        function saveByLink() {
            const link = document.getElementById('inp-link').value;
            const title = document.getElementById('inp-title').value;
            if (!link || !title) return alert("Isi link dan judul!");
            simpanLocal(link, 'video'); // Asumsi link luar adalah video
        }

        function simpanLocal(url, type) {
            const title = document.getElementById('inp-title').value;
            const desc = document.getElementById('inp-desc').value;
            const momentData = {
                id: Date.now(),
                type: type,
                path: url,
                title: title,
                desc: desc,
                date: new Date().toLocaleDateString('id-ID')
            };
            let list = JSON.parse(localStorage.getItem('naufal_cloudinary')) || [];
            list.unshift(momentData);
            localStorage.setItem('naufal_cloudinary', JSON.stringify(list));
            
            alert("Berhasil!");
            location.reload();
        }

        function pindahTab(tab) {
            document.getElementById('view-add').classList.toggle('hidden', tab !== 'add');
            document.getElementById('view-gallery').classList.toggle('hidden', tab !== 'gallery');
            document.getElementById('nav-add').classList.toggle('active', tab === 'add');
            document.getElementById('nav-gallery').classList.toggle('active', tab === 'gallery');
            if(tab === 'gallery') render();
        }

        function render() {
            const container = document.getElementById('gallery-list');
            const data = JSON.parse(localStorage.getItem('naufal_cloudinary')) || [];
            container.innerHTML = data.map(m => `
                <div class="moment-card">
                    ${m.type === 'video' ? `<video controls src="${m.path}"></video>` : `<img src="${m.path}">`}
                    <div class="moment-body">
                        <div style="font-weight:bold;">${m.title}</div>
                        <p style="font-size:0.9rem; color:#666;">${m.desc}</p>
                        <button onclick="hapus(${m.id})" style="color:red; border:none; background:none; cursor:pointer;">Hapus</button>
                    </div>
                </div>
            `).join('');
        }

        function hapus(id) {
            if(confirm("Hapus?")) {
                let list = JSON.parse(localStorage.getItem('naufal_cloudinary')).filter(m => m.id !== id);
                localStorage.setItem('naufal_cloudinary', JSON.stringify(list));
                render();
            }
        }
    </script>
</body>
</html>
